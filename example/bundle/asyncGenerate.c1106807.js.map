{"mappings":"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","sources":["node_modules/@parcel/runtime-js/lib/helpers/bundle-manifest.js","node_modules/@parcel/runtime-js/lib/runtime-357f355de461847e.js","src/workers/GenerateMeshBVHWorker.js","node_modules/@parcel/runtime-js/lib/runtime-c4c4a379841c658c.js","node_modules/@parcel/runtime-js/lib/helpers/get-worker-url.js","node_modules/@parcel/runtime-js/lib/helpers/bundle-url.js"],"sourcesContent":["\"use strict\";\n\nvar mapping = {};\n\nfunction register(pairs) {\n  var keys = Object.keys(pairs);\n\n  for (var i = 0; i < keys.length; i++) {\n    mapping[keys[i]] = pairs[keys[i]];\n  }\n}\n\nfunction resolve(id) {\n  var resolved = mapping[id];\n\n  if (resolved == null) {\n    throw new Error('Could not resolve bundle with id ' + id);\n  }\n\n  return resolved;\n}\n\nmodule.exports.register = register;\nmodule.exports.resolve = resolve;","require('./helpers/bundle-manifest').register(JSON.parse(\"{\\\"4Tpm3\\\":\\\"asyncGenerate.c1106807.js\\\",\\\"8LgXY\\\":\\\"generateAsync.worker.f030fc94.js\\\"}\"));","import { Box3, BufferAttribute } from 'three';\nimport { MeshBVH } from '../core/MeshBVH.js';\n\nexport class GenerateMeshBVHWorker {\n\n\tconstructor() {\n\n\t\tthis.running = false;\n\t\tthis.worker = new Worker( new URL( './generateAsync.worker.js', import.meta.url ), { type: 'module' } );\n\t\tthis.worker.onerror = e => {\n\n\t\t\tif ( e.message ) {\n\n\t\t\t\tthrow new Error( `GenerateMeshBVHWorker: Could not create Web Worker with error \"${ e.message }\"` );\n\n\t\t\t} else {\n\n\t\t\t\tthrow new Error( 'GenerateMeshBVHWorker: Could not create Web Worker.' );\n\n\t\t\t}\n\n\t\t};\n\n\t}\n\n\tgenerate( geometry, options = {} ) {\n\n\t\tif ( this.running ) {\n\n\t\t\tthrow new Error( 'GenerateMeshBVHWorker: Already running job.' );\n\n\t\t}\n\n\t\tif ( this.worker === null ) {\n\n\t\t\tthrow new Error( 'GenerateMeshBVHWorker: Worker has been disposed.' );\n\n\t\t}\n\n\t\tconst { worker } = this;\n\t\tthis.running = true;\n\n\t\treturn new Promise( ( resolve, reject ) => {\n\n\t\t\tworker.onerror = e => {\n\n\t\t\t\treject( new Error( `GenerateMeshBVHWorker: ${ e.message }` ) );\n\t\t\t\tthis.running = false;\n\n\t\t\t};\n\n\t\t\tworker.onmessage = e => {\n\n\t\t\t\tthis.running = false;\n\t\t\t\tconst { data } = e;\n\n\t\t\t\tif ( data.error ) {\n\n\t\t\t\t\treject( new Error( data.error ) );\n\t\t\t\t\tworker.onmessage = null;\n\n\t\t\t\t} else if ( data.serialized ) {\n\n\t\t\t\t\tconst { serialized, position } = data;\n\t\t\t\t\tconst bvh = MeshBVH.deserialize( serialized, geometry, { setIndex: false } );\n\t\t\t\t\tconst boundsOptions = Object.assign( {\n\n\t\t\t\t\t\tsetBoundingBox: true,\n\n\t\t\t\t\t}, options );\n\n\t\t\t\t\t// we need to replace the arrays because they're neutered entirely by the\n\t\t\t\t\t// webworker transfer.\n\t\t\t\t\tgeometry.attributes.position.array = position;\n\t\t\t\t\tif ( geometry.index ) {\n\n\t\t\t\t\t\tgeometry.index.array = serialized.index;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tconst newIndex = new BufferAttribute( serialized.index, 1, false );\n\t\t\t\t\t\tgeometry.setIndex( newIndex );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( boundsOptions.setBoundingBox ) {\n\n\t\t\t\t\t\tgeometry.boundingBox = bvh.getBoundingBox( new Box3() );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve( bvh );\n\t\t\t\t\tworker.onmessage = null;\n\n\t\t\t\t} else if ( options.onProgress ) {\n\n\t\t\t\t\toptions.onProgress( data.progress );\n\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t\tconst index = geometry.index ? geometry.index.array : null;\n\t\t\tconst position = geometry.attributes.position.array;\n\n\t\t\tif ( position.isInterleavedBufferAttribute || index && index.isInterleavedBufferAttribute ) {\n\n\t\t\t\tthrow new Error( 'GenerateMeshBVHWorker: InterleavedBufferAttribute are not supported for the geometry attributes.' );\n\n\t\t\t}\n\n\t\t\tconst transferrables = [ position ];\n\t\t\tif ( index ) {\n\n\t\t\t\ttransferrables.push( index );\n\n\t\t\t}\n\n\t\t\tworker.postMessage( {\n\n\t\t\t\tindex,\n\t\t\t\tposition,\n\t\t\t\toptions: {\n\t\t\t\t\t...options,\n\t\t\t\t\tonProgress: null,\n\t\t\t\t\tincludedProgressCallback: Boolean( options.onProgress ),\n\t\t\t\t\tgroups: [ ... geometry.groups ],\n\t\t\t\t},\n\n\t\t\t}, transferrables.map( arr => arr.buffer ) );\n\n\t\t} );\n\n\t}\n\n\tdispose() {\n\n\t\tthis.worker.terminate();\n\t\tthis.worker = null;\n\n\t}\n\n\tterminate() {\n\n\t\tconsole.warn( 'GenerateMeshBVHWorker: \"terminate\" is deprecated. Use \"dispose\" instead.' );\n\t\tthis.dispose();\n\n\t}\n\n}\n","let workerURL = require('./helpers/get-worker-url');\nlet bundleURL = require('./helpers/bundle-url');\nlet url = bundleURL.getBundleURL('4Tpm3') + require('./helpers/bundle-manifest').resolve(\"8LgXY\");module.exports = workerURL(url, bundleURL.getOrigin(url), true);","\"use strict\";\n\nmodule.exports = function (workerUrl, origin, isESM) {\n  if (origin === self.location.origin) {\n    // If the worker bundle's url is on the same origin as the document,\n    // use the worker bundle's own url.\n    return workerUrl;\n  } else {\n    // Otherwise, create a blob URL which loads the worker bundle with `importScripts`.\n    var source = isESM ? 'import ' + JSON.stringify(workerUrl) + ';' : 'importScripts(' + JSON.stringify(workerUrl) + ');';\n    return URL.createObjectURL(new Blob([source], {\n      type: 'application/javascript'\n    }));\n  }\n};","\"use strict\";\n\nvar bundleURL = {};\n\nfunction getBundleURLCached(id) {\n  var value = bundleURL[id];\n\n  if (!value) {\n    value = getBundleURL();\n    bundleURL[id] = value;\n  }\n\n  return value;\n}\n\nfunction getBundleURL() {\n  try {\n    throw new Error();\n  } catch (err) {\n    var matches = ('' + err.stack).match(/(https?|file|ftp):\\/\\/[^)\\n]+/g);\n\n    if (matches) {\n      // The first two stack frames will be this function and getBundleURLCached.\n      // Use the 3rd one, which will be a runtime in the original bundle.\n      return getBaseURL(matches[2]);\n    }\n  }\n\n  return '/';\n}\n\nfunction getBaseURL(url) {\n  return ('' + url).replace(/^((?:https?|file|ftp):\\/\\/.+)\\/[^/]+$/, '$1') + '/';\n} // TODO: Replace uses with `new URL(url).origin` when ie11 is no longer supported.\n\n\nfunction getOrigin(url) {\n  var matches = ('' + url).match(/(https?|file|ftp):\\/\\/[^/]+/);\n\n  if (!matches) {\n    throw new Error('Origin not found');\n  }\n\n  return matches[0];\n}\n\nexports.getBundleURL = getBundleURLCached;\nexports.getBaseURL = getBaseURL;\nexports.getOrigin = getOrigin;"],"names":["$8b4d1930797b255e$export$6503ec6e8aabbaf","$8b4d1930797b255e$export$f7ad0328861e2f03","$8b4d1930797b255e$var$mapping","pairs","keys","Object","i","length","id","resolved","Error","parcelRequire","register","JSON","parse","$2a15da384e51c9e3$export$426cc6213ad628cf","this","running","worker","Worker","type","onerror","e","message","generate","geometry","options","Promise","resolve","reject","onmessage","data","error","serialized","position","bvh","$7xeSy","MeshBVH","deserialize","setIndex","boundsOptions","assign","setBoundingBox","attributes","array","index","newIndex","$hGT0Q","BufferAttribute","boundingBox","getBoundingBox","Box3","onProgress","progress","isInterleavedBufferAttribute","transferrables","push","postMessage","includedProgressCallback","Boolean","groups","map","arr","buffer","dispose","terminate","console","warn","$ac1b221e9d8f8f45$var$url","$kPq84","getBundleURL","module","exports","$hxJhJ","getOrigin","workerUrl","origin","isESM","self","location","source","stringify","URL","createObjectURL","Blob","$f29cd6c67ea13581$export$bdfd709ae4826697","$f29cd6c67ea13581$export$5a759dc7a1cfb72a","$f29cd6c67ea13581$var$bundleURL","$f29cd6c67ea13581$var$getBaseURL","url","replace","value","err","matches","stack","match","$f29cd6c67ea13581$var$getBundleURL"],"version":3,"file":"asyncGenerate.c1106807.js.map"}